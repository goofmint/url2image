# URL to OGP Image Generator

URLからOGP画像を生成するNode.js Web APIアプリケーションです。Puppeteerを使用してWebページのスクリーンショットを取得し、指定されたフォーマットで画像を返却します。

## 機能

- 🖼️ URLからスクリーンショット画像を生成
- 📏 カスタマイズ可能な画像サイズ（幅・高さ）
- 🎨 複数の画像フォーマット対応（JPEG、PNG、WebP）
- 🌐 日本語対応
- 🔒 セキュリティ機能（レート制限、ヘルメット）
- 🐳 Docker対応

## 必要条件

- Node.js 18以上
- npm または yarn

## インストール

### ローカル環境

```bash
# 依存関係をインストール
npm install

# 開発サーバーを起動
npm run dev

# 本番サーバーを起動
npm start
```

### Docker環境

```bash
# Dockerイメージをビルド
docker build -t urltoogp .

# コンテナを起動
docker run -p 3000:3000 urltoogp
```

## API仕様

### スクリーンショット生成

**エンドポイント:** `GET /api/screenshot`

**パラメータ:**

| パラメータ | 必須 | デフォルト値 | 説明 |
|-----------|------|-------------|------|
| `url` | ✅ | - | スクリーンショットを取得するURL |
| `width` | ❌ | 800 | 画像の幅（ピクセル、100-2000） |
| `height` | ❌ | 600 | 画像の高さ（ピクセル、100-2000） |
| `format` | ❌ | jpeg | 画像フォーマット（jpeg, png, webp） |

**使用例:**

```bash
# 基本的な使用
curl "http://localhost:3000/api/screenshot?url=https://example.com"

# カスタムサイズとフォーマット
curl "http://localhost:3000/api/screenshot?url=https://example.com&width=1200&height=800&format=png"
```

**レスポンス:**
- 成功時: 指定されたフォーマットの画像ファイル
- エラー時: JSON形式のエラーメッセージ

### ヘルスチェック

**エンドポイント:** `GET /health`

**レスポンス:**
```json
{
  "status": "OK",
  "message": "サービスは正常に動作しています"
}
```

## 環境変数

| 変数名 | デフォルト値 | 説明 |
|--------|-------------|------|
| `PORT` | 3000 | サーバーのポート番号 |

## セキュリティ機能

- **レート制限:** IPアドレスごとに15分間に最大100リクエスト
- **セキュリティヘッダー:** Helmet.jsによるセキュリティヘッダー設定
- **CORS対応:** クロスオリジンリクエストの制御
- **入力検証:** URL形式とパラメータ値の検証

## 制限事項

- 画像サイズ: 幅・高さともに100px〜2000pxの範囲
- 対応フォーマット: JPEG、PNG、WebP
- タイムアウト: 30秒（ページ読み込み）
- レート制限: 15分間に100リクエスト

## トラブルシューティング

### よくある問題

1. **Puppeteerの起動エラー**
   - Docker環境では自動的に解決されます
   - ローカル環境ではChrome/Chromiumのインストールが必要です

2. **日本語が表示されない**
   - Docker環境では日本語フォントが自動的にインストールされます
   - ローカル環境では日本語フォントのインストールが必要です

3. **メモリ不足エラー**
   - 大きなページのスクリーンショット時に発生する可能性があります
   - 画像サイズを小さくするか、ページの複雑さを考慮してください

## ライセンス

ISC License 